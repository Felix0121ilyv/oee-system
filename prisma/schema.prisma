generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id          String   @id @default(cuid())
  name        String
  email       String   @unique
  password    String
  role        String   @default("OPERATOR") // ADMIN, SUPERVISOR, OPERATOR
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  productions ProductionRecord[]
  stoppages   Stoppage[]
}

model Machine {
  id            String   @id @default(cuid())
  name          String
  area          String
  idealSpeed    Float    // units per minute
  plannedTime   Float    // minutes per shift
  active        Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  productions ProductionRecord[]
  stoppages   Stoppage[]
}

model ProductionRecord {
  id              String   @id @default(cuid())
  machineId       String
  userId          String
  date            DateTime
  shift           String   // MORNING, AFTERNOON, NIGHT
  totalProduction Int
  defects         Int
  operativeTime   Float    // minutes
  createdAt       DateTime @default(now())

  machine Machine @relation(fields: [machineId], references: [id], onDelete: Cascade)
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Stoppage {
  id           String   @id @default(cuid())
  machineId    String
  userId       String
  reason       String
  type         String   // PLANNED, UNPLANNED
  duration     Float    // minutes
  date         DateTime
  observations String?
  createdAt    DateTime @default(now())

  machine Machine @relation(fields: [machineId], references: [id], onDelete: Cascade)
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model SystemConfig {
  id                    String   @id @default("singleton")
  oeeGoal               Float    @default(0.85)
  stopCostPerMin        Float    @default(50.0)
  defectCostPerUnit     Float    @default(15.0)
  productionValuePerUnit Float   @default(25.0)
  shifts                String   @default("[\"MORNING\",\"AFTERNOON\",\"NIGHT\"]")
  stopReasons           String   @default("[\"Falla mecánica\",\"Falla eléctrica\",\"Falta de material\",\"Cambio de formato\",\"Mantenimiento preventivo\",\"Operador ausente\",\"Calidad\",\"Otro\"]")
  updatedAt             DateTime @updatedAt
}
